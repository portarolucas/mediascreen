<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
  <meta charset="utf-8">
  <title>Gestion des séquences - MediaScreen</title>
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous"/>
  <link rel="stylesheet" href="https://unpkg.com/browse/normalize.css@8.0.1/normalize.css">
  <link rel="stylesheet" href="./css/gestion_sequence.css">

  <style>
    .notification{
      position: fixed;
      top: 0;left:0;
      width: 100%;
    }
  </style>



</head>
<body>
  
  <div id="notification_block" class="notification" style="z-index: 999;display: none;">
    <button class="delete" onclick="hideNotification()"></button>
    <p></p>
  </div>

  <nav class="navbar navbar-expand-lg navbar-light navbar-laravel">
    <div class="container">
      <a class="navbar-brand" href="admin_panel.html">Retour</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <i class="fas fa-user-cog"></i>
            <a class="nav-link" href="#">Lucaas855</a>
          </li>
          <li class="nav-item">
            <i class="fas fa-sign-out-alt"></i>
            <a class="nav-link" href="#">Déconnexion</a>
          </li>
        </ul>

      </div>
    </div>
  </nav>
  <div class="main-content">
    <div class="container">
      <h1>Gestion séquence</h1>
      <table class="table table-sm table-hover">
        <thead>
          <tr>
            <th style="width: 10%;">ID</th>
            <th style="width: 30%;">Nom séquence</th>
            <th style="width: 25%;">Nombre d'écrans associé</th>
            <th style="width: 25%;">Auteur</th>
            <th style="width: 5%;"></th>
            <th style="width: 5%;"></th>
          </tr>
        </thead>

        <tbody>
          <tr>
            <td class="panel_ID">1</td>
            <td class="panel_nomSeq"><span class="editable">Écran salle 2</span></td>
            <td class="panel_nombreEcran"><span class="editable">4</span></td>
            <td class="panel_auteur"><span class="editable">Lucaas855</span></td>
            <td class="panel_update">
              <button type="button" class="btn btn-default btn-sm" data-toggle="modal" data-target="#editSequence_1">
                <i class="far fa-edit"></i>
              </button>
              <div class="modal fade exampleModalClass" id="editSequence_1" tabindex="-1" role="dialog" aria-labelledby="editSequenceLabel_1">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h4 class="modal-title" id="editSequenceLabel_1">Modifier la séquence</h4>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Fermer"><span aria-hidden="true">×</span></button>
                    </div>
                    <div class="modal-body">
                      <form>
                        <div class="form-group">
                          <label class="control-label">Nom séquence :</label>
                          <input type="text" value="Écran salle 2" class="form-control update_nomSequence">
                        </div>
                      </form>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
                      <button type="button" class="btn btn-dark" onclick="updateSequence(1, this)">Modifier la séquence</button>
                    </div>
                  </div>
                </div>
              </div>
            </td>
            <td class="panel_delete">
              <input type="button" value="Supprimer" class="btn btn-danger delCompteBtn" data-toggle="modal" data-target="#deleteSequence_1">
              <div class="modal fade" id="deleteSequence_1" tabindex="-1" role="dialog" aria-labelledby="deleteSequenceLabel_1" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h4 class="modal-title" id="deleteSequenceLabel_1">Supprimer une séquence :</h4>
                    </div>
                    <div class="modal-body">
                      <p>Êtes-vous sûr de vouloir supprimer la séquence : Écran salle 2 ?</p>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
                      <button type="button" class="btn btn-danger btn-ok" onclick="deleteSequence(1, this)">Supprimer</button>
                    </div>
                  </div>
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <td class="panel_ID">2</td>
            <td class="panel_nomSeq"><span class="editable">Écran salle de cinéma</span></td>
            <td class="panel_nombreEcran"><span class="editable">7</span></td>
            <td class="panel_auteur"><span class="editable">Evan92i</span></td>
            <td class="panel_update">
              <button type="button" class="btn btn-default btn-sm" data-toggle="modal" data-target="#editSequence_2">
                <i class="far fa-edit"></i>
              </button>
              <div class="modal fade exampleModalClass" id="editSequence_2" tabindex="-1" role="dialog" aria-labelledby="editSequenceLabel_2">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h4 class="modal-title" id="editSequenceLabel_2">Modifier la séquence</h4>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Fermer"><span aria-hidden="true">×</span></button>
                    </div>
                    <div class="modal-body">
                      <form>
                        <div class="form-group">
                          <label class="control-label">Nom séquence :</label>
                          <input type="text" value="Écran salle de cinéma" class="form-control update_nomSequence">
                        </div>
                      </form>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
                      <button type="button" class="btn btn-dark" onclick="updateSequence(2, this)">Modifier la séquence</button>
                    </div>
                  </div>
                </div>
              </div>
            </td>
            <td class="panel_delete">
              <input type="button" value="Supprimer" class="btn btn-danger delCompteBtn" data-toggle="modal" data-target="#deleteSequence_2">
              <div class="modal fade" id="deleteSequence_2" tabindex="-1" role="dialog" aria-labelledby="deleteSequenceLabel_2" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h4 class="modal-title" id="deleteSequenceLabel_2">Supprimer une séquence :</h4>
                    </div>
                    <div class="modal-body">
                      <p>Êtes-vous sûr de vouloir supprimer la séquence : Écran salle de cinéma ?</p>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
                      <button type="button" class="btn btn-danger btn-ok" onclick="deleteSequence(2, this)">Supprimer</button>
                    </div>
                  </div>
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <td class="panel_ID">3</td>
            <td class="panel_nomSeq"><span class="editable">Écran salle de pause (coin café)</span></td>
            <td class="panel_nombreEcran"><span class="editable">2</span></td>
            <td class="panel_auteur"><span class="editable">Ozzie57</span></td>
            <td class="panel_update">
              <button type="button" class="btn btn-default btn-sm" data-toggle="modal" data-target="#editSequence_3">
                <i class="far fa-edit"></i>
              </button>
              <div class="modal fade exampleModalClass" id="editSequence_3" tabindex="-1" role="dialog" aria-labelledby="editSequenceLabel_3">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h4 class="modal-title" id="editSequenceLabel_3">Modifier la séquence</h4>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Fermer"><span aria-hidden="true">×</span></button>
                    </div>
                    <div class="modal-body">
                      <form>
                        <div class="form-group">
                          <label class="control-label">Nom séquence :</label>
                          <input type="text" value="Écran salle de pause (coin café)" class="form-control update_nomSequence">
                        </div>
                      </form>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
                      <button type="button" class="btn btn-dark" onclick="updateSequence(3, this)">Modifier la séquence</button>
                    </div>
                  </div>
                </div>
              </div>
            </td>
            <td class="panel_delete">
              <input type="button" value="Supprimer" class="btn btn-danger delCompteBtn" data-toggle="modal" data-target="#deleteSequence_3">
              <div class="modal fade" id="deleteSequence_3" tabindex="-1" role="dialog" aria-labelledby="deleteSequenceLabel_3" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h4 class="modal-title" id="deleteSequenceLabel_3">Supprimer une séquence :</h4>
                    </div>
                    <div class="modal-body">
                      <p>Êtes-vous sûr de vouloir supprimer la séquence : Écran salle de pause (coin café) ? <br>Attention : celà supprimera tous les écrans associés à cette séquence !</p>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
                      <button type="button" class="btn btn-danger btn-ok" onclick="deleteSequence(3, this)">Supprimer</button>
                    </div>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <script type="text/javascript">
  function hideNotification(){
    $('#notification_block').fadeOut('500', () => {
      $('#notification_block').removeClass();
    });
  }

  function showNotification(libelle_bootstrap, message){
    hideNotification();
    $('#notification_block p').text(message)
    $('#notification_block').addClass("notification")
    $('#notification_block').addClass(classStatus)
    $('#notification_block').fadeIn('500');
  }

  function deleteSequence(id, leBtn)
  {
      let model = $(leBtn).parents().closest('.modal');
      let lineDelet = $(leBtn).parents().closest('tr');

      let http = new XMLHttpRequest();
      let params =
          'id=' + id;
      http.open('POST', './../public/app/resources/model/ajax_gestionEcran.php?delSequence', true);

      http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
      http.onreadystatechange = function()
      {
          if(http.readyState == 4 && http.status == 200)
          {
              if(http.responseText == 'success')
              {
                  $(model).modal('hide');
                  showNotification('success', "La séquence a bien été supprimée.");
                  $(lineDelet).hide('slow', function(){ $(lineDelet).remove(); });
              }
              else
              {
                showNotification('danger', 'Erreur : ' + http.responseText);
              }
          }
      }
      http.send(params);
  }
  function updateEcran(id, leBtn){
    let bodyModal = $(leBtn).parent().prev('.modal-body');
    let nom = $(bodyModal).find('.update_nomSequence').val();

    if(id, nom) {
      let model = $(leBtn).parents().closest('.modal');
      let lineUpdate = $(leBtn).parents().closest('tr');
      let http = new XMLHttpRequest();

      let params =
      'id=' + id
      + '&newNom=' + nom;
      http.open('POST', './../public/app/resources/model/ajax_gestionEcran.php?updateSequence', true);

      http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
      http.onreadystatechange = function () {
        if(http.readyState == 4 && http.status == 200)
        {
            if(http.responseText == 'success')
            {
                $(model).modal('hide');
                createMessageAlert('blue', 'Succès', "L'écran : " + nom + " a bien été mis à jour.")
                $(lineDelet).hide('slow', function(){ $(lineDelet).remove(); });
            }
            else
            {
                createMessageAlert('red', 'Erreur', http.responseText);
            }
        }
      }
      http.send(params);
    }
    else
    {
      alert("Une erreur est survenue : des champs sont manquants, introuvable, ou incomplet \n\rSi le problème persiste actualisez la page ou contacter l'administrateur du site");
    }
  }
  </script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
</body>
</html>